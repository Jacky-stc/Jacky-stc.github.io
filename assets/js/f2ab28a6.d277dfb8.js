"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[7817],{6491:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>u,frontMatter:()=>a,metadata:()=>r,toc:()=>l});const r=JSON.parse('{"id":"React/What is React Query","title":"What is React Query","description":"\u4ec0\u9ebc\u662f React Query\uff08TanStack Query\uff09?","source":"@site/docs/React/What is React Query.md","sourceDirName":"React","slug":"/React/What is React Query","permalink":"/React/What is React Query","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/React/What is React Query.md","tags":[],"version":"current","frontMatter":{"title":"What is React Query","hide_title":true},"sidebar":"tutorialSidebar","previous":{"title":"Client Component\u3001Server Compon","permalink":"/React/Client Component\u3001Server Component"},"next":{"title":"useRef","permalink":"/React/useRef"}}');var i=t(4848),s=t(8453);const a={title:"What is React Query",hide_title:!0},o=void 0,c={},l=[{value:"\u4ec0\u9ebc\u662f React Query\uff08TanStack Query\uff09?",id:"\u4ec0\u9ebc\u662f-react-querytanstack-query",level:3},{value:"\u5b89\u88dd\uff08Installation\uff09",id:"\u5b89\u88ddinstallation",level:3},{value:"\u914d\u7f6e\uff08Setup\uff09",id:"\u914d\u7f6esetup",level:3},{value:"\u8cc7\u6599\u6293\u53d6\uff08Data-Fetching\uff09",id:"\u8cc7\u6599\u6293\u53d6data-fetching",level:3}];function d(e){const n={a:"a",admonition:"admonition",blockquote:"blockquote",code:"code",h3:"h3",hr:"hr",img:"img",li:"li",mdxAdmonitionTitle:"mdxAdmonitionTitle",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h3,{id:"\u4ec0\u9ebc\u662f-react-querytanstack-query",children:"\u4ec0\u9ebc\u662f React Query\uff08TanStack Query\uff09?"}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"\u53c3\u8003\u8cc7\u6599"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.a,{href:"https://tanstack.com/query/latest",children:"https://tanstack.com/query/latest"})}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"\u9019\u662f\u5b98\u65b9\u6587\u4ef6\u63d0\u4f9b\u7684\u8aaa\u6cd5"}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"It makes fetching, caching, synchronizing and updating server state in your web applications a breeze."}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["\u5927\u591a\u6578\u7684web\u6846\u67b6\u90fd\u6c92\u6709\u4e00\u5957\u6bd4\u8f03\u5b8c\u5584\u4e14\u56fa\u5b9a\u7684\u65b9\u6cd5\u53bb\u8655\u7406data-fetching\uff0c\u5176\u4e2d\u4f60\u6703\u9047\u5230\u8a31\u591a\u554f\u984c\uff0c\u4f8b\u5982error-handling\u3001\u5feb\u53d6\u3001\u8cc7\u6599\u8655\u7406\u7b49\uff0c\u5728React\u4e2d\u4f60\u4e5f\u8a31\u6703\u9078\u64c7\u900f\u904e\n",(0,i.jsx)(n.code,{children:"use state"}),"\u3001",(0,i.jsx)(n.code,{children:"use effect"}),"\u3001",(0,i.jsx)(n.code,{children:"try"}),"\u3001",(0,i.jsx)(n.code,{children:"catch"}),"\u7b49\u4f86\u89e3\u6c7aerror-handling\u7684\u554f\u984c\uff0c\u4e0b\u9762\u662f\u4e00\u500b\u7c21\u55ae\u7684\u4f8b\u5b50\uff1a"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"import React, { useState, useEffect } from 'react';\n\nconst DataFetchingComponent = () => {\n  const [data, setData] = useState(null);\n  const [error, setError] = useState(null);\n  const [loading, setLoading] = useState(true);\n\n  useEffect(() => {\n    const fetchData = async () => {\n      try {\n        setLoading(true);\n        const response = await fetch('https://api.example.com/data');\n        if (!response.ok) {\n          throw new Error(`HTTP error! status: ${response.status}`);\n        }\n        const result = await response.json();\n        setData(result);\n      } catch (err) {\n        setError(err.message);\n      } finally {\n        setLoading(false);\n      }\n    };\n\n    fetchData();\n  }, []);\n\n  if (loading) return <p>Loading...</p>;\n  if (error) return <p>Error: {error}</p>;\n\n  return <div>{JSON.stringify(data)}</div>;\n};\n\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u4f46\u9019\u6a23\u6703\u5c0e\u81f4\u4f60\u7684\u7a0b\u5f0f\u78bc\u975e\u5e38\u5197\u9577\u4e14\u96e3\u4ee5\u7dad\u8b77\uff0c\u65bc\u662f\u958b\u767c\u8005\u5c07\u4e00\u7cfb\u5217\u7684\u529f\u80fd\u6574\u5408\u5728\u4e00\u8d77\u751f\u6210\u4e86Tanstack Query\u9019\u500b\u7b2c\u4e09\u65b9\u5957\u4ef6\uff0c\u5e6b\u52a9\u6211\u5011\u4ee5\u6700\u7c21\u6f54\u7684\u65b9\u5f0f\u8655\u7406\u9019\u4e9b\u8b93\u4eba\u982d\u75db\u7684\u554f\u984c"}),"\n",(0,i.jsxs)(n.admonition,{type:"warning",children:[(0,i.jsx)(n.mdxAdmonitionTitle,{}),(0,i.jsx)(n.p,{children:"\u4ee5\u4e0b\u7684\u64cd\u4f5c\u90fd\u662f\u4ee5Next.js app router\u70ba\u4e3b\uff0c\u53ef\u80fd\u6703\u8207\u55ae\u7d14\u4f7f\u7528React\u6216\u662fNext.js page router\u6709\u4e9b\u8a31\u5dee\u7570"})]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"\u5b89\u88ddinstallation",children:"\u5b89\u88dd\uff08Installation\uff09"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"npm i @tanstack/react-query\n"})}),"\n",(0,i.jsx)(n.h3,{id:"\u914d\u7f6esetup",children:"\u914d\u7f6e\uff08Setup\uff09"}),"\n",(0,i.jsxs)(n.p,{children:["\u9996\u5148\u8981\u5148\u5275\u7acb\u4e00\u500bProvider\u5c07\u7db2\u7ad9\u5305\u88f9\u8d77\u4f86\uff0c\u6211\u5011\u624d\u80fd\u5728\u88e1\u9762\u57f7\u884cReact-query\u7684\u529f\u80fd\uff0c\u4f46\u662f\u7531\u65bc ",(0,i.jsx)(n.code,{children:"QueryClientProvider"}),"\u5fc5\u9808\u8981\u5728Client-Side\u57f7\u884c\uff0c\u6240\u4ee5\u6211\u5011\u8981\u53e6\u5916\u5275\u7acb\u4e00\u500bClient Component ",(0,i.jsx)(n.code,{children:"Provider.tsx"})," \u4e26\u900f\u904eimport\u5c07\u5176\u5c0e\u5165",(0,i.jsx)(n.code,{children:"layout.tsx"}),"\u4e2d\uff0c\u800c\u4e0d\u80fd\u76f4\u63a5\u5728",(0,i.jsx)(n.code,{children:"layout.tsx"}),"\u4e2d\u8a2d\u5b9a\u3002\n\u4ee5\u4e0b\u662fReact-Query\u5b98\u65b9\u7684\u8a2d\u5b9a\u6a94\uff1a"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-tsx",children:"// In Next.js, this file would be called: app/providers.tsx\n'use client'\n\n// Since QueryClientProvider relies on useContext under the hood, we have to put 'use client' on top\nimport {\n  isServer,\n  QueryClient,\n  QueryClientProvider,\n} from '@tanstack/react-query'\n\nfunction makeQueryClient() {\n  return new QueryClient({\n    defaultOptions: {\n      queries: {\n        // With SSR, we usually want to set some default staleTime\n        // above 0 to avoid refetching immediately on the client\n        staleTime: 60 * 1000,\n      },\n    },\n  })\n}\n\nlet browserQueryClient: QueryClient | undefined = undefined\n\nfunction getQueryClient() {\n  if (isServer) {\n    // Server: always make a new query client\n    return makeQueryClient()\n  } else {\n    // Browser: make a new query client if we don't already have one\n    // This is very important, so we don't re-make a new client if React\n    // suspends during the initial render. This may not be needed if we\n    // have a suspense boundary BELOW the creation of the query client\n    if (!browserQueryClient) browserQueryClient = makeQueryClient()\n    return browserQueryClient\n  }\n}\n\nexport default function Providers({ children }: { children: React.ReactNode }) {\n  // NOTE: Avoid useState when initializing the query client if you don't\n  //       have a suspense boundary between this and the code that may\n  //       suspend because React will throw away the client on the initial\n  //       render if it suspends and there is no boundary\n  const queryClient = getQueryClient()\n\n  return (\n    <QueryClientProvider client={queryClient}>{children}</QueryClientProvider>\n  )\n}\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-tsx",children:"// In Next.js, this file would be called: app/layout.tsx\nimport Providers from './providers'\n\nexport default function RootLayout({\n  children,\n}: {\n  children: React.ReactNode\n}) {\n  return (\n    <html lang=\"en\">\n      <head />\n      <body>\n        <Providers>{children}</Providers>\n      </body>\n    </html>\n  )\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"\u8cc7\u6599\u6293\u53d6data-fetching",children:"\u8cc7\u6599\u6293\u53d6\uff08Data-Fetching\uff09"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"useQuery"}),"\nuseQuery\u9069\u7528\u65bc\u4efb\u4f55\u975e\u540c\u6b65\u7684\u8cc7\u6599\u8acb\u6c42\uff0c\u4ed6\u6703\u8207\u4e00\u500bunique key\u505a\u7d81\u5b9a\uff0c\u6709\u9ede\u985e\u4f3cuseEffect\u4e2ddependency\u7684\u6982\u5ff5\uff0c\u8981\u4f7f\u7528useQuery\u6700\u5c11\u9700\u8981\u7d66\u4e88queryKey\u3001queryFn\u5169\u500b\u53c3\u6578\u3002"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"queryKey"}),"\uff1aqueryKey\u662f\u4e00\u7d44\u6578\u5217\uff0c\u6bcf\u4e00\u500buseQuery\u90fd\u61c9\u8a72\u7d81\u5b9a\u4e00\u7d44\u7279\u5b9a\u7684queryKey"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"queryFn"}),"\uff1a\u4e00\u500b\u56de\u50b3\u503c\u662fPromise\u7684function\uff0c\u7d50\u679c\u5fc5\u9808\u8981\u662f ",(0,i.jsx)(n.code,{children:"resolve"})," \u6216\u662f ",(0,i.jsx)(n.code,{children:"throw new Error"})]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"import { useQuery } from '@tanstack/react-query'\n\nfunction App() {\n  const info = useQuery({ queryKey: ['todos'], queryFn: fetchTodoList })\n}\n"})}),"\n",(0,i.jsxs)(n.p,{children:["\u6211\u5011\u628a ",(0,i.jsx)(n.code,{children:"info"}),"\u6253\u5370\u51fa\u4f86\u5c31\u53ef\u4ee5\u770b\u5230\u88e1\u9762\u5305\u542b\u4e86\u6211\u5011\u9700\u8981\u7684data\u4ee5\u53ca\u5404\u7a2e\u975e\u5e38\u5be6\u7528\u7684\u53c3\u6578\uff0c\u50cf\u662f",(0,i.jsx)(n.code,{children:"isLoading"}),"\u3001",(0,i.jsx)(n.code,{children:"isError"}),"\u3001",(0,i.jsx)(n.code,{children:"isFetching"}),"\u7b49\u7b49\n",(0,i.jsx)(n.img,{src:"https://hackmd-prod-images.s3-ap-northeast-1.amazonaws.com/uploads/upload_c69b60dcf60b14dc4949843396e9be4f.png?AWSAccessKeyId=AKIA3XSAAW6AWSKNINWO&Expires=1732788348&Signature=XcqFNMrPdKbH7lOJ%2BFRETR5pwYg%3D",alt:"\u87a2\u5e55\u64f7\u53d6\u756b\u9762 2024-11-28 175828"})]})]})}function u(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>a,x:()=>o});var r=t(6540);const i={},s=r.createContext(i);function a(e){const n=r.useContext(s);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),r.createElement(s.Provider,{value:n},e.children)}}}]);