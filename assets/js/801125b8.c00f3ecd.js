"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[9788],{4536:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>r,default:()=>u,frontMatter:()=>i,metadata:()=>a,toc:()=>l});const a=JSON.parse('{"id":"Redux/Immutable State","title":"Immutable State","description":"\u95dc\u65bcState Immutable\u9019\u4ef6\u4e8b","source":"@site/docs/Redux/Immutable State.md","sourceDirName":"Redux","slug":"/Redux/Immutable State","permalink":"/Redux/Immutable State","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/Redux/Immutable State.md","tags":[{"inline":true,"label":"Redux","permalink":"/tags/redux"}],"version":"current","frontMatter":{"title":"Immutable State","tags":["Redux"],"hide_title":true},"sidebar":"tutorialSidebar","previous":{"title":"useRef","permalink":"/React/useRef"},"next":{"title":"Redux-Persist\u554f\u984c","permalink":"/Redux/Redux-Persist\u554f\u984c"}}');var o=n(4848),s=n(8453);const i={title:"Immutable State",tags:["Redux"],hide_title:!0},r=void 0,d={},l=[{value:"\u95dc\u65bcState Immutable\u9019\u4ef6\u4e8b",id:"\u95dc\u65bcstate-immutable\u9019\u4ef6\u4e8b",level:3},{value:"Redux Toolkit\u8207Immer",id:"redux-toolkit\u8207immer",level:3}];function c(e){const t={admonition:"admonition",code:"code",h3:"h3",mdxAdmonitionTitle:"mdxAdmonitionTitle",p:"p",pre:"pre",strong:"strong",...(0,s.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(t.h3,{id:"\u95dc\u65bcstate-immutable\u9019\u4ef6\u4e8b",children:"\u95dc\u65bcState Immutable\u9019\u4ef6\u4e8b"}),"\n",(0,o.jsx)(t.p,{children:"\u5728\u539f\u751f\u7684Redux\u4e2d\uff0cstate\u90fd\u662fimmutable\u7684\uff0c\u4e5f\u5c31\u662f\u6211\u5011\u5728\u64cd\u4f5cactions\u6642\u4e0d\u61c9\u8a72\u76f4\u63a5\u53bb\u6539\u8b8a\u539f\u672c\u7684state\uff0c\u800c\u662f\u8fd4\u9084\u4e00\u500b\u5168\u65b0\u7684\u7269\u4ef6\uff0c\u50cf\u662f\u9019\u6a23"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-javascript",children:"function insertItem(array, action) {\n  return [\n    ...array.slice(0, action.index),\n    action.item,\n    ...array.slice(action.index)\n  ]\n}\n// \u4e0d\u53bb\u8b8a\u52d5\u539f\u672c\u7684array\u7269\u4ef6\uff0c\u800c\u662f\u900f\u904e\u904b\u7b97\u5c55\u958b\u7b26\u5275\u5efa\u4e26\u8fd4\u56de\u4e00\u500b\u5168\u65b0\u7684array\n"})}),"\n",(0,o.jsx)(t.admonition,{type:"caution",children:(0,o.jsxs)(t.mdxAdmonitionTitle,{children:["\u4f46\u662f\u6709\u8da3\u7684\u4e8b\u60c5\u662f\uff0c\u5982\u679c\u7528\u9019\u500b\u65b9\u5f0f\u7d50\u5408redux toolkit\u4f86\u5bebreducers\u53ef\u80fd\u662f",(0,o.jsx)(t.strong,{children:"\u932f\u7684"})]})}),"\n",(0,o.jsx)(t.h3,{id:"redux-toolkit\u8207immer",children:"Redux Toolkit\u8207Immer"}),"\n",(0,o.jsx)(t.p,{children:"Immer\u662f\u4e00\u500b\u7b2c\u4e09\u65b9\u5957\u4ef6\uff0c\u7c21\u5316\u4e86\u66f4\u65b0immutable\u7269\u4ef6\u7684\u904e\u7a0b\u3002"}),"\n",(0,o.jsxs)(t.p,{children:["Immer\u63d0\u4f9b\u4e86\u4e00\u500bfunciton\u53eb\u505a ",(0,o.jsx)(t.code,{children:"produce"}),"\uff0c\u4ed6\u6703\u63a5\u6536\u5169\u500b\u53c3\u6578\uff0c\u4e00\u500b\u662f\u4f60\u539f\u59cb\u7684 ",(0,o.jsx)(t.code,{children:"state"}),"\uff0c\u53e6\u4e00\u500b\u662f\u4e00\u500b ",(0,o.jsx)(t.code,{children:"callback function"}),"\uff0c\u9019\u500b ",(0,o.jsx)(t.code,{children:"callback function"})," \u6703\u5efa\u7acb\u4e00\u500b\u539f\u59cb ",(0,o.jsx)(t.code,{children:"state"})," \u7684\u7bc4\u672c\uff0c\u4e26\u4e14\u900f\u904e\u66f4\u65b0\u4e26\u8fd4\u9084\u9019\u500b\u7bc4\u672c\u4f86\u907f\u514d\u5c0d\u539f\u59cb\u8cc7\u6599\u505a\u66f4\u52d5\u3002"]}),"\n",(0,o.jsx)(t.p,{children:"Redux Toolkit\u6703\u81ea\u52d5\u5957\u7528Immer\uff0c\u8b93\u4f60\u53ef\u4ee5\u5728\u64b0\u5bebmutating\u8a9e\u6cd5\u7684\u6642\u5019\u5c0d\u65bcimmutable state\u505a\u66f4\u65b0\uff0c\u7c21\u5316\u4e86\u8907\u96dc\u7684\u64b0\u5beb\u6d41\u7a0b"}),"\n",(0,o.jsx)(t.p,{children:"\u6240\u4ee5\u5982\u679c\u60f3\u8981\u5728Redux Toolkit\u4e2d\u66f4\u65b0state\uff0c\u53ef\u4ee5\u76f4\u63a5\u4ee5mutating\u7684\u8a9e\u6cd5\u64b0\u5beb\u5373\u53ef"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-javascript",children:"import { createSlice } from '@reduxjs/toolkit';\n\nconst initialState = {\n  todos: [],\n};\nconst todoSlice = createSlice({\n  name: 'todo',\n  initialState,\n  reducers: {\n    addTodo: (state, action) => {\n      state.todos.push(action.payload);\n        //  \u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528Array.push()\u8a9e\u6cd5\u800c\u4e0d\u7528\u64d4\u5fc3\u6703\u76f4\u63a5\u66f4\u52d5\u5230\u539f\u672c\u7684state\n    },\n  },\n});\nexport const { addTodo } = todoSlice.actions;\nexport default todoSlice.reducer;\n"})}),"\n",(0,o.jsx)(t.p,{children:"Redux Toolkit\u4e2d\u7684createSlice\u6703\u300c\u671f\u5f85\u300d\u4f60\u4f7f\u7528mutating\u7684\u5beb\u6cd5\uff0c\u6240\u4ee5\u5982\u679c\u4f60\u5805\u6301\u8981\u4ee5immutable\u7684\u5beb\u6cd5\u751a\u81f3\u6703\u6709type error"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-javascript",children:"addTodo: (state, action)=>{\n            return {\n                ...state,\n                todos:[...state.todos, action.payload],\n            }\n        },\n"})}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-javascript",children:"// Error\nType '(state: WritableDraft<{ todos: never[]; }>, action: { payload: any; type: string; }) => { todos: any[]; }' is not assignable to type 'CaseReducer<{ todos: never[]; }, { payload: any; type: string; }> | CaseReducerWithPrepare<{ todos: never[]; }, PayloadAction<any, string, any, any>>'.\n  Type '(state: WritableDraft<{ todos: never[]; }>, action: { payload: any; type: string; }) => { todos: any[]; }' is not assignable to type 'CaseReducer<{ todos: never[]; }, { payload: any; type: string; }>'.\n    Type '{ todos: any[]; }' is not assignable to type 'void | { todos: never[]; } | WritableDraft<{ todos: never[]; }>'.\n      Type '{ todos: any[]; }' is not assignable to type 'WritableDraft<{ todos: never[]; }>'.\n        Types of property 'todos' are incompatible.\n          Type 'any[]' is not assignable to type 'never[]'.\n            Type 'any' is not assignable to type 'never'.ts(2322)\n"})}),"\n",(0,o.jsxs)(t.p,{children:["\u96a8\u7136\u9019\u6a23\u5e7e\u4e4e\u53ef\u4ee5\u5b8c\u5168\u907f\u514dmutating state\u7684\u554f\u984c\uff0c\u4f46\u662f\u53ef\u80fd\u6703\u8b93\u8a31\u591a\u4eba\u5728\u5b78\u7fd2\u8207\u64b0\u5bebRedux reducers\u7684\u904e\u7a0b\u4e2d\u5ffd\u7565\u4e86",(0,o.jsx)(t.strong,{children:"State Immutable"}),"\u9019\u500b\u975e\u5e38\u91cd\u8981\u4e14\u6838\u5fc3\u7684Rule"]})]})}function u(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,o.jsx)(t,{...e,children:(0,o.jsx)(c,{...e})}):c(e)}},8453:(e,t,n)=>{n.d(t,{R:()=>i,x:()=>r});var a=n(6540);const o={},s=a.createContext(o);function i(e){const t=a.useContext(s);return a.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function r(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:i(e.components),a.createElement(s.Provider,{value:t},e.children)}}}]);